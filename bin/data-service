#!/usr/bin/env node
var program = require('gitlike-cli');

/* LIST
************/
function listUsers() {
  var run = require('./list-users.js');
  run();
}

function listSensors(args) {
  var run = require('./list-sensors.js');
  run(args.userUID);
}

function listDatastreams(args) {
  var run = require('./list-datastreams.js');
  run(args.userUID, args.sensorUID);
}

function listRecords(args) {
  var run = require('./list-records.js');
  run(args.datastreamUID);
}

/* SHOW
************/
function showUser(args) {
  var run = require('./show-user.js');
  run(args.uid);
}

function showSensor(args) {
  var run = require('./show-sensor.js');
  run(args.userUID, args.sensorUID);
}

function showDatastream(args) {
  var run = require('./show-datastream.js');
  run(args.userUID, args.sensorUID, args.datastreamUID);
}

function showRecord(args) {
  var run = require('./show-record.js');
  run(args.datastreamUID, args.recordUID);
}

/* CREATE
************/
function createUser(args) {
  var input = args.etc[0];
  var body = '';
  input.on('data', function (chunk) {
    body += chunk;
  });

  input.on('end', function () {
    var run = require('./create-user.js');
    run(body);
  });
}

/* Parse Args
************/
program
  .command('list')
    .command('users')
      .description("List all users")
      .action(listUsers)
      .parent
    .command('sensors <userUID>')
      .description("List sensors for a user")
      .action(listSensors)
      .parent
    .command('datastreams <userUID> <sensorUID>')
      .description("List datastreams for a sensor")
      .action(listDatastreams)
      .parent
    .command('records <datastreamUID>')
      .description("List records for a datastream")
      .action(listRecords)
      .parent
    .parent

  .command('show')
    .command('user <UID>')
      .description("Show a user")
      .action(showUser)
      .parent
    .command('sensor <userUID> <sensorUID>')
      .description("Show a sensor")
      .action(showSensor)
      .parent
    .command('datastream <userUID> <sensorUID> <datastreamUID>')
      .description("Show a datastream")
      .action(showDatastream)
      .parent
    .command('record <datastreamUID> <recordUID>')
      .description("Show a datastream record")
      .action(showRecord)
      .parent
    .parent

  .command('create')
    .command('user')
      .description("Create a user. Pipe a JSON representation of the user to this command.")
      .action(createUser)
      .on('help', function(cmd) {
        cmd.outputIndented('Examples', [
          '$ bin/data-service create user < new-user.json',
          '$ cat new-user.json | bin/data-service create user'
        ]);
      })
      .parent
    .parent
  .parse(process.argv);

